<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing Plans | Soil AI Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <!-- Quill Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        :root {
            --bg-color: #05070a;
            --accent-color: #00ff88;
            --card-bg: rgba(20, 25, 30, 0.6);
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-color);
            color: white;
            margin: 0;
            display: flex;
        }

        .sidebar {
            width: 250px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            padding: 2rem;
            position: fixed;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 3rem;
            color: var(--accent-color);
        }

        .nav-links {
            list-style: none;
            padding: 0;
        }

        .nav-links li {
            margin-bottom: 1.5rem;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: 0.3s;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--accent-color);
        }

        .main-content {
            margin-left: 250px;
            padding: 3rem;
            width: 100%;
        }

        .plan-editor {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 3rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        input,
        textarea {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            color: white;
            outline: none;
        }

        input:focus {
            border-color: var(--accent-color);
        }

        #editor-container {
            height: 200px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .ql-toolbar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px 10px 0 0;
            border-color: rgba(255, 255, 255, 0.1) !important;
        }

        .ql-container {
            border-radius: 0 0 10px 10px;
            border-color: rgba(255, 255, 255, 0.1) !important;
        }

        .btn {
            background: var(--accent-color);
            color: black;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 800;
            cursor: pointer;
        }

        .plans-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .plan-card {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 20px;
            position: relative;
        }

        .plan-card.featured {
            border-color: var(--accent-color);
        }

        .discount-badge {
            position: absolute;
            top: -10px;
            left: 20px;
            background: #ff4444;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: 800;
        }

        .plan-card h3 {
            margin: 0;
            color: var(--accent-color);
        }

        .plan-card .price {
            font-size: 2rem;
            font-weight: 800;
            margin: 10px 0;
        }

        .old-price {
            text-decoration: line-through;
            color: #ff4444;
            font-size: 1rem;
            margin-right: 10px;
        }

        .plan-card .description {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
            font-style: italic;
        }

        .plan-card .features {
            font-size: 0.8rem;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .edit-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            color: var(--accent-color);
            cursor: pointer;
        }

        .logout {
            color: #ff4444 !important;
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <div class="logo"><i class="fas fa-seedling"></i> Soil AI Admin</div>
        <ul class="nav-links">
            <li><a href="{{ url_for('admin_dashboard') }}"
                    class="{{ 'active' if active_page == 'dashboard' else '' }}"><i class="fas fa-chart-line"></i>
                    Dashboard</a></li>
            <li><a href="{{ url_for('admin_users') }}" class="{{ 'active' if active_page == 'users' else '' }}"><i
                        class="fas fa-users"></i> Users Management</a></li>
            <li><a href="{{ url_for('admin_scans') }}" class="{{ 'active' if active_page == 'scans' else '' }}"><i
                        class="fas fa-flask"></i> Scan History</a></li>
            <li><a href="{{ url_for('admin_plans') }}" class="{{ 'active' if active_page == 'plans' else '' }}"><i
                        class="fas fa-tags"></i> Pricing Plans</a></li>
            <li><a href="{{ url_for('admin_settings') }}" class="{{ 'active' if active_page == 'settings' else '' }}"><i
                        class="fas fa-cog"></i> Settings</a></li>
            <li><a href="{{ url_for('admin_logout') }}" class="logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </li>
        </ul>
    </div>

    <div class="main-content">
        <header>
            <h1>Manage Business Plans</h1>
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div
            style="padding: 10px; border-radius: 10px; margin-bottom: 20px; background: rgba(0,255,136,0.1); border: 1px solid var(--accent-color);">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <div class="plan-editor">
            <h3 id="editor-title">Add New Plan</h3>
            <form method="POST" id="plan-form">
                <input type="hidden" name="id" id="plan-id">
                <input type="hidden" name="features" id="features-input">
                <div class="form-row">
                    <div class="form-group">
                        <label>Plan Name</label>
                        <input type="text" name="name" id="plan-name" required placeholder="e.g., Farmer Pro">
                    </div>
                    <div class="form-group">
                        <label>Price ($/mo)</label>
                        <input type="text" name="price" id="plan-price" required placeholder="29">
                    </div>
                    <div class="form-group">
                        <label>Discount (e.g., 20% OFF)</label>
                        <input type="text" name="discount" id="plan-discount" placeholder="Optional">
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 20px;">
                    <label>Short Description</label>
                    <textarea name="description" id="plan-description" rows="2"
                        placeholder="Best for medium farms..."></textarea>
                </div>
                <div class="form-group" style="margin-bottom: 20px;">
                    <label>Features (Detailed Content)</label>
                    <div id="editor-container"></div>
                </div>
                <div class="form-group"
                    style="flex-direction: row; align-items: center; gap: 10px; margin-bottom: 20px;">
                    <input type="checkbox" name="is_featured" id="plan-featured">
                    <label for="plan-featured">Mark as Featured / Popular</label>
                </div>
                <button type="submit" class="btn">Save Plan</button>
                <button type="button" class="btn" onclick="resetForm()"
                    style="background: rgba(255,255,255,0.1); color: white; margin-left: 10px;">Cancel</button>
            </form>
        </div>

        <h3>Active Plans</h3>
        <div class="plans-list">
            {% for plan in plans %}
            <div class="plan-card {{ 'featured' if plan.is_featured else '' }}">
                {% if plan.discount %}
                <div class="discount-badge">{{ plan.discount }}</div>
                {% endif %}
                <div class="edit-btn" onclick='editPlan({{ plan|tojson }})'>
                    <i class="fas fa-edit"></i>
                </div>
                <h3>{{ plan.name }}</h3>
                <div class="price">
                    {% if plan.discount %}
                    <span class="old-price">${{ (plan.price|float * 1.2)|round|int }}</span>
                    {% endif %}
                    ${{ plan.price }}<span>/mo</span>
                </div>
                <div class="description">{{ plan.description }}</div>
                <div class="features">
                    {{ plan.features|safe }}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Quill JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        var quill = new Quill('#editor-container', {
            theme: 'snow',
            modules: {
                toolbar: [
                    ['bold', 'italic', 'underline'],
                    [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                    ['clean']
                ]
            }
        });

        document.getElementById('plan-form').onsubmit = function () {
            document.getElementById('features-input').value = quill.root.innerHTML;
        };

        function editPlan(plan) {
            document.getElementById('editor-title').innerText = 'Edit Plan: ' + plan.name;
            document.getElementById('plan-id').value = plan.id;
            document.getElementById('plan-name').value = plan.name;
            document.getElementById('plan-price').value = plan.price;
            document.getElementById('plan-discount').value = plan.discount || '';
            document.getElementById('plan-description').value = plan.description || '';
            quill.root.innerHTML = plan.features;
            document.getElementById('plan-featured').checked = plan.is_featured;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function resetForm() {
            document.getElementById('editor-title').innerText = 'Add New Plan';
            document.getElementById('plan-id').value = '';
            document.getElementById('plan-name').value = '';
            document.getElementById('plan-price').value = '';
            document.getElementById('plan-discount').value = '';
            document.getElementById('plan-description').value = '';
            quill.root.innerHTML = '';
            document.getElementById('plan-featured').checked = false;
        }
    </script>
</body>

</html>